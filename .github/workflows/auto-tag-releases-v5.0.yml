# ~~ Generated by projen. To modify, edit .projenrc.ts and run "npx projen".

name: auto-tag-releases-v5.0
run-name: Auto-Tag Release (v5.0)
on:
  schedule:
    - cron: 0 5 * * 1
  workflow_dispatch: {}
jobs:
  pre-flight:
    name: Pre-Flight Checks
    runs-on: ubuntu-latest
    permissions:
      contents: read
    outputs:
      sha: ${{ steps.git.outputs.sha }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          repository: ${{ github.repository }}
          ref: maintenance/v5.0
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          cache: yarn
          node-version: 16.14.0
      - name: Install dependencies
        run: yarn install --frozen-lockfile
      - name: Build
        run: yarn build
      - name: Identify git SHA
        id: git
        run: echo sha=$(git rev-parse HEAD) >> $GITHUB_OUTPUT
  auto-tag:
    name: Auto-Tag Release
    needs: pre-flight
    runs-on: ubuntu-latest
    permissions: {}
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          repository: ${{ github.repository }}
          token: ${{ secrets.PROJEN_GITHUB_TOKEN }}
          ref: ${{ needs.pre-flight.outputs.sha }}
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          cache: yarn
          node-version: 16.14.0
      - name: Install dependencies
        run: yarn install --frozen-lockfile
      - name: Set git identity
        run: |-
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
      - name: Tag Release
        run: "yarn tag-release --idempotent --no-sign --push "
